<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Painel Administrativo – UpLife</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <style>
    * { box-sizing: border-box; }
    body { font-family: 'Poppins', sans-serif; background: linear-gradient(135deg, #fafafa, #f5c6a9); margin: 0; padding: 40px 20px; display: flex; flex-direction: column; align-items: center; }
    h1 { color: #e65100; font-size: 32px; margin-bottom: 30px; }
    h2 { color: #e65100; margin-top: 40px; margin-bottom: 20px; font-size: 24px; }
    form { background: #fff; width: 100%; max-width: 700px; padding: 30px; border-radius: 16px; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05); }
    label { display: block; margin-top: 20px; font-weight: 600; font-size: 14px; color: #333; }
    input, textarea, select { width: 100%; padding: 12px; margin-top: 6px; border: 1px solid #ccc; border-radius: 8px; font-size: 14px; transition: 0.2s; }
    textarea { overflow: hidden; resize: none; }
    input:focus, textarea:focus, select:focus { border-color: #e65100; outline: none; }
    button { margin-top: 30px; background: #e65100; color: white; border: none; padding: 14px 24px; font-size: 16px; font-weight: bold; border-radius: 8px; cursor: pointer; transition: background 0.3s ease; }
    button:hover { background: #cf4c00; }
    .container { width: 100%; max-width: 700px; }
    .vaga, .solicitacao { background: #fff; padding: 20px; border-radius: 14px; margin-bottom: 20px; box-shadow: 0 4px 16px rgba(0, 0, 0, 0.05); transition: transform 0.2s ease; }
    .vaga:hover, .solicitacao:hover { transform: scale(1.01); }
    .btn-excluir, .btn-editar { background: #e65100; color: white; border: none; padding: 10px 16px; border-radius: 6px; font-size: 14px; cursor: pointer; margin-top: 10px; transition: background 0.3s ease; }
    .btn-excluir:hover, .btn-editar:hover { background: #cf4c00; }
    a { color: #e65100; font-weight: bold; text-decoration: none; }
    a:hover { text-decoration: underline; }
    small { color: #777; }
  </style>
</head>
<body>
<h1>Painel Administrativo</h1>
<div class="container">
  <h2>Cadastrar Nova Vaga</h2>
  <form id="formVaga">
    <!-- campos do formulário aqui (mantidos como estão) -->
    <button type="submit">Cadastrar Vaga</button>
  </form>

  <h2>Vagas Cadastradas</h2>
  <div id="listaVagas"></div>

  <h2>Solicitações de Vagas Personalizadas</h2>
  <div id="listaSolicitacoes"></div>
</div>

<script>
const API_VAGAS = '/api/vagas';
let vagaEditando = null;

// --- FUNÇÃO PARA CARREGAR VAGAS ---
async function carregarVagas() {
  try {
    const res = await fetch(API_VAGAS);
    if(!res.ok) throw new Error(`Erro ao buscar vagas: ${res.status}`);
    const vagas = await res.json();
    const lista = document.getElementById('listaVagas');
    lista.innerHTML = '';
    vagas.forEach(v => {
      const div = document.createElement('div');
      div.className = 'vaga';
      div.innerHTML = `
        <strong>${v.titulo}</strong><br>
        Empresa: ${v.empresa||'-'}<br>
        Função: ${v.funcao||'-'}<br>
        Local: ${v.local}<br>
        Área: ${v.area}<br>
        Descrição: ${v.descricao.length>100?v.descricao.substring(0,100)+'...':v.descricao}<br>
        <a href="${v.link}" target="_blank">Ver Link</a><br>
        <button class="btn-excluir" onclick="excluirVaga(${v.id})">Excluir</button>
        <button class="btn-editar" onclick='editarVaga(${JSON.stringify(v).replace(/'/g,"\\'")})'>Editar</button>
      `;
      lista.appendChild(div);
    });
  } catch(e) { console.error('Erro ao carregar vagas:', e); }
}

// --- FUNÇÃO PARA EXCLUIR VAGA ---
async function excluirVaga(id){
  if(!confirm('Tem certeza que deseja excluir esta vaga?')) return;
  try {
    const res = await fetch(`${API_VAGAS}/${id}`, { method: 'DELETE' });
    if(!res.ok) throw new Error(`Erro ao excluir: ${res.status}`);
    carregarVagas();
  } catch(e) { console.error(e); alert('Erro ao excluir vaga'); }
}

// --- FUNÇÃO EDITAR VAGA ---
function editarVaga(vaga){
  const f=document.getElementById('formVaga');
  f.titulo.value=vaga.titulo;
  f.empresa.value=vaga.empresa;
  f.funcao.value=vaga.funcao;
  f.local.value=vaga.local;
  f.area.value=vaga.area;
  f.descricao.value=vaga.descricao;
  f.link.value=vaga.link;
  f.tecnicoCompetencia.checked=vaga.tecnicoCompetencia||false;
  if(vaga.curso){
    f.cursoNome.value=vaga.curso.nome||'';
    f.cursoDescricao.value=vaga.curso.descricao||'';
    f.cursoImagem.value=vaga.curso.imagem||'';
    f.cursoLink.value=vaga.curso.link||'';
  }
  vagaEditando=vaga.id;
  window.scrollTo({top:0, behavior:'smooth'});
}

// --- FORM SUBMIT ---
document.getElementById('formVaga').addEventListener('submit', async e=>{
  e.preventDefault();
  const f=e.target;
  const vaga={
    titulo:f.titulo.value,
    empresa:f.empresa.value,
    funcao:f.funcao.value,
    local:f.local.value,
    area:f.area.value,
    descricao:f.descricao.value,
    link:f.link.value,
    tecnicoCompetencia:f.tecnicoCompetencia.checked,
    curso:{
      nome:f.cursoNome.value,
      descricao:f.cursoDescricao.value,
      imagem:f.cursoImagem.value,
      link:f.cursoLink.value
    }
  };
  try {
    const metodo = vagaEditando ? 'PUT' : 'POST';
    const url = vagaEditando ? `${API_VAGAS}/${vagaEditando}` : API_VAGAS;
    const res = await fetch(url, {
      method: metodo,
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(vaga)
    });
    if(!res.ok) throw new Error(`Erro ao salvar vaga: ${res.status}`);
    f.reset();
    vagaEditando = null;
    carregarVagas();
  } catch(e) { console.error(e); alert('Erro ao salvar vaga'); }
});

// --- FUNÇÃO CARREGAR SOLICITAÇÕES ---
async function carregarSolicitacoes(){
  const lista=document.getElementById('listaSolicitacoes');
  lista.innerHTML='<p>Nenhuma solicitação registrada.</p>';
}

// --- AUTO AJUSTE TEXTAREA ---
document.querySelectorAll("textarea").forEach(t=>{
  t.addEventListener("input", e=>{
    e.target.style.height='auto';
    e.target.style.height=e.target.scrollHeight+'px';
  });
  t.dispatchEvent(new Event('input'));
});

// --- CARREGAR AO ABRIR ---
carregarVagas();
carregarSolicitacoes();
</script>
</body>
</html>
