<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Painel Administrativo – UpLife</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <style>
    * { box-sizing: border-box; }
    body {
      font-family: 'Poppins', sans-serif;
      margin: 0;
      padding: 0;
      background: #f4f4f4;
    }
    header {
      background: #f78c1e;
      padding: 20px;
      color: #fff;
      text-align: center;
    }
    main {
      padding: 20px;
    }
    .vaga {
      background: #fff;
      padding: 15px;
      margin-bottom: 10px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    button { margin-right: 5px; }
  </style>
</head>
<body>
  <header>
    <h1>Painel Administrativo – UpLife</h1>
  </header>
  <main>
    <h2>Vagas Criadas</h2>
    <div id="vagas-container"></div>

    <h2>Cadastrar Nova Vaga</h2>
    <form id="form-vaga">
      <input type="text" id="titulo" placeholder="Título" required><br><br>
      <textarea id="descricao" placeholder="Descrição" required></textarea><br><br>
      <input type="text" id="area" placeholder="Área" required><br><br>
      <input type="text" id="link" placeholder="Link" required><br><br>
      <input type="text" id="curso" placeholder="Curso"><br><br>
      <label>
        <input type="checkbox" id="tecnicoCompetencia"> Técnico por Competência
      </label><br><br>
      <button type="submit">Cadastrar Vaga</button>
    </form>
  </main>

  <script>
    const vagasContainer = document.getElementById('vagas-container');
    const formVaga = document.getElementById('form-vaga');

    // Função para carregar vagas
    async function carregarVagas() {
      try {
        const res = await fetch('/api/vagas');
        const text = await res.text();
        let vagas;
        try {
          vagas = JSON.parse(text);
        } catch (err) {
          console.error("Erro ao interpretar JSON:", err, text);
          vagas = [];
        }

        vagasContainer.innerHTML = '';
        vagas.forEach(vaga => {
          const div = document.createElement('div');
          div.className = 'vaga';
          div.innerHTML = `
            <strong>${vaga.titulo}</strong> - ${vaga.area}<br>
            ${vaga.descricao}<br>
            <a href="${vaga.link}" target="_blank">Link</a><br>
            Curso: ${vaga.curso || '-'}<br>
            Técnico por Competência: ${vaga.tecnicoCompetencia ? 'Sim' : 'Não'}<br>
            <button onclick="editarVaga(${vaga.id})">Editar</button>
            <button onclick="excluirVaga(${vaga.id})">Excluir</button>
          `;
          vagasContainer.appendChild(div);
        });
      } catch(e) {
        console.error("Erro ao carregar vagas:", e);
        vagasContainer.innerHTML = '<p>Erro ao carregar vagas.</p>';
      }
    }

    // Cadastrar vaga
    formVaga.addEventListener('submit', async (e) => {
      e.preventDefault();
      const novaVaga = {
        titulo: document.getElementById('titulo').value,
        descricao: document.getElementById('descricao').value,
        area: document.getElementById('area').value,
        link: document.getElementById('link').value,
        curso: document.getElementById('curso').value,
        tecnicoCompetencia: document.getElementById('tecnicoCompetencia').checked
      };

      try {
        const res = await fetch('/api/vagas', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(novaVaga)
        });
        if (res.ok) {
          formVaga.reset();
          carregarVagas();
        } else {
          console.error("Erro ao cadastrar vaga:", await res.text());
        }
      } catch(e) {
        console.error("Erro no POST:", e);
      }
    });

    // Funções Editar / Excluir
    async function excluirVaga(id) {
      if (!confirm('Deseja realmente excluir esta vaga?')) return;
      try {
        const res = await fetch(`/api/vagas/${id}`, { method: 'DELETE' });
        if (res.ok) carregarVagas();
        else console.error("Erro ao excluir:", await res.text());
      } catch(e) {
        console.error(e);
      }
    }

    function editarVaga(id) {
      alert('Funcionalidade de editar ainda não implementada.');
    }

    // Carregar vagas ao iniciar
    carregarVagas();
  </script>
</body>
</html>
