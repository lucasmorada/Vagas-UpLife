<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Painel Administrativo – UpLife</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <style>
    * { box-sizing: border-box; }
    body {
      font-family: 'Poppins';
      background: #e65100;
      margin: 0;
      padding: 40px 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    h1 { color: #fefefe; font-size: 40px; margin-bottom: 30px; }
    h2 { color: #ffffff; margin-top: 40px; margin-bottom: 20px; font-size: 24px; }
    form {
      background: #fff;
      width: 100%;
      max-width: 700px;
      padding: 30px;
      border-radius: 16px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
    }
    label { display: block; margin-top: 20px; font-weight: 600; font-size: 14px; color: #333; }
    input, textarea, select {
      width: 100%;
      padding: 12px;
      margin-top: 6px;
      border: 1px solid #ccc;
      border-radius: 8px;
      font-size: 14px;
      transition: 0.2s;
    }
    textarea { overflow: hidden; resize: none; }
    input:focus, textarea:focus, select:focus { border-color: #e65100; outline: none; }
    button {
      margin-top: 30px;
      background: #e65100;
      color: white;
      border: none;
      padding: 14px 24px;
      font-size: 16px;
      font-weight: bold;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.3s ease;
    }
    button:hover { background: #cf4c00; }
    .container { width: 100%; max-width: 700px; }
    .vaga {
      background: #fff;
      padding: 20px;
      border-radius: 14px;
      margin-bottom: 20px;
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.05);
      transition: transform 0.2s ease;
    }
    .vaga:hover { transform: scale(1.01); }
    .btn-excluir, .btn-editar {
      background: #e65100;
      color: white;
      border: none;
      padding: 10px 16px;
      border-radius: 6px;
      font-size: 14px;
      cursor: pointer;
      margin-top: 10px;
      transition: background 0.3s ease;
    }
    .btn-excluir:hover, .btn-editar:hover { background: #cf4c00; }
    small { color: #777; }
  </style>
</head>
<body>

<h1>Painel Administrativo</h1>

<div class="container">
  <h2>Cadastrar Nova Vaga</h2>
  <form id="formVaga">
    <label for="titulo">Título da Vaga</label>
    <input type="text" id="titulo" name="titulo" required>

    <label for="empresa">Empresa</label>
    <input type="text" id="empresa" name="empresa" required>

    <label for="localizacao">Localização</label>
    <input type="text" id="localizacao" name="localizacao">

    <label for="salario">Salário</label>
    <input type="number" id="salario" name="salario" step="0.01">

    <label for="area">Área</label>
    <select id="area" name="area" required>
      <option value="">Selecione uma área</option>
      <option value="Manutenção">Manutenção</option>
      <option value="Mecânica">Mecânica</option>
      <option value="Produção">Produção</option>
      <option value="Elétrica">Elétrica</option>
      <option value="Segurança do Trabalho">Segurança do Trabalho</option>
      <option value="Planejamento">Planejamento</option>
      <option value="Automação">Automação</option>
      <option value="Outras">Outras</option>
    </select>

    <label for="descricao">Descrição</label>
    <textarea id="descricao" name="descricao" rows="4" required></textarea>

    <label for="link">Link da Vaga</label>
    <input type="url" id="link" name="link" placeholder="https://exemplo.com" >

    <label>
      <input type="checkbox" id="tecnico" name="tecnico">
      Técnico por competência
    </label>

    <button type="submit">Salvar Vaga</button>
  </form>

  <h2>Vagas Cadastradas</h2>
  <div id="listaVagas"></div>
</div>

<script>
let vagaEditando = null;

// --- CARREGAR VAGAS ---
async function carregarVagas() {
  const res = await fetch('/api/vagas');
  const vagas = await res.json();
  const lista = document.getElementById('listaVagas');
  lista.innerHTML = '';
  vagas.forEach(v => {
    const div = document.createElement('div');
    div.className = 'vaga';
    div.innerHTML = `
      <strong>${v.titulo}</strong><br>
      <strong>Empresa:</strong> ${v.empresa}<br>
      <strong>Localização:</strong> ${v.localizacao || '-'}<br>
      <strong>Salário:</strong> ${v.salario || '-'}<br>
      <strong>Área:</strong> ${v.area}<br>
      <strong>Descrição:</strong> ${v.descricao}<br>
      <strong>Link:</strong> ${v.link ? `<a href="${v.link}" target="_blank">${v.link}</a>` : '-'}<br>
      <small>Técnico: ${v.tecnico ? 'Sim' : 'Não'}</small><br>
      <button class="btn-excluir" onclick="excluirVaga(${v.id})">Excluir</button>
      <button class="btn-editar" onclick='editarVaga(${JSON.stringify(v)})'>Editar</button>
    `;
    lista.appendChild(div);
  });
}

// --- EXCLUIR VAGA ---
async function excluirVaga(id) {
  if (!confirm('Excluir esta vaga?')) return;
  await fetch(`/api/vagas/${id}`, { method: 'DELETE' });
  carregarVagas();
}

// --- EDITAR VAGA ---
function editarVaga(v) {
  const f = document.getElementById('formVaga');
  f.titulo.value = v.titulo;
  f.empresa.value = v.empresa;
  f.localizacao.value = v.localizacao || '';
  f.salario.value = v.salario || '';
  f.area.value = v.area;
  f.descricao.value = v.descricao;
  f.link.value = v.link || '';
  f.tecnico.checked = v.tecnico;
  vagaEditando = v.id;
  window.scrollTo({ top: 0, behavior: 'smooth' });
}

// --- SUBMIT ---
document.getElementById('formVaga').addEventListener('submit', async e => {
  e.preventDefault();
  const f = e.target;
  const vaga = {
  titulo: f.titulo.value,
  empresa: f.empresa.value,
  localizacao: f.localizacao.value,
  salario: f.salario.value ? parseFloat(f.salario.value) : null,
  area: f.area.value,
  descricao: f.descricao.value,
  tecnico: f.tecnico.checked,
  link: f.link.value,
  local: null
  };

  if (vagaEditando) {
    await fetch(`/api/vagas/${vagaEditando}`, {
      method: 'PUT',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(vaga)
    });
    vagaEditando = null;
  } else {
    await fetch('/api/vagas', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(vaga)
    });
  }
  f.reset();
  carregarVagas();
});

// --- AUTO AJUSTE TEXTAREA ---
document.querySelectorAll("textarea").forEach(t => {
  t.addEventListener("input", e => {
    e.target.style.height = 'auto';
    e.target.style.height = e.target.scrollHeight + 'px';
  });
  t.dispatchEvent(new Event('input'));
});

// --- INICIAR ---
carregarVagas();
</script>

</body>
</html>
